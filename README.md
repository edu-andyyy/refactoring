# Refactoring
Лабораторная работа 6

## Проблемы качества кода (Code Smells)

1. **Long Method** — функция `process_checkout` содержала >50 строк с валидацией, расчётами и формированием ответа
2. **Magic Numbers** — числа `0.10`, `0.20`, `0.05`, `0.21`, `50`, `10`, `100`, `200` использовались без пояснений
3. **Нарушение SRP** — одна функция отвечала за валидацию, расчёт скидок, налогов и генерацию ID
4. **Дублирование логики** — цикл по items для валидации и подсчёта суммы
5. **Неявные значения по умолчанию** — `"USD"` захардкожен внутри функции

## Применённые рефакторинги

| Рефакторинг | Описание |
|-------------|----------|
| **Extract Constant** | Вынесены константы: `TAX_RATE`, `DEFAULT_CURRENCY`, параметры купонов |
| **Extract Method** | Созданы функции: `validate_request`, `_validate_item`, `calculate_subtotal`, `calculate_discount`, `calculate_tax`, `generate_order_id` |
| **Replace Loop with Pipeline** | `sum()` вместо ручного цикла в `calculate_subtotal` |
| **Simplify Conditional** | Упрощена логика скидок с early return |
| **Replace Temp with Query** | `max(subtotal - discount, 0)` вместо if-блока |

## Что улучшилось

- **Читаемость**: `process_checkout` теперь <10 строк и читается как сценарий сверху вниз
- **Тестируемость**: каждую функцию можно тестировать отдельно
- **Изменяемость**: для изменения ставки налога достаточно поменять одну константу
- **DRY**: валидация товара вынесена в `_validate_item`
- **KISS**: каждая функция делает одно простое действие

## Проверка

Все тесты проходят:
```bash
python3 -m pytest test_order_processing.py -v
```
